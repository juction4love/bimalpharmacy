<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bimal Pharmacy Search</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.6.2/fuse.min.js"></script>
    
    <style>
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background-color: #eef2f3; 
            margin: 0; 
            padding: 20px; 
        }

        .container { 
            max-width: 600px; 
            margin: 0 auto; 
            background: white; 
            padding: 20px; 
            border-radius: 15px; 
            box-shadow: 0 10px 25px rgba(0,0,0,0.1); 
            overflow: hidden; /* Keeps the header inside rounded corners */
        }

        /* --- THIS IS THE NEW THEME --- */
        .header-banner {
            background: linear-gradient(135deg, #42b983 0%, #2c8558 100%); /* Green Gradient */
            color: white;
            text-align: center;
            padding: 25px;
            margin: -20px -20px 20px -20px; /* Stretches to edges */
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        h2 { 
            margin: 0; 
            font-size: 24px;
            letter-spacing: 1px;
        }
        
        .subtitle {
            font-size: 14px;
            opacity: 0.9;
            margin-top: 5px;
        }
        /* ----------------------------- */

        .search-box {
            width: 100%; 
            padding: 15px; 
            font-size: 18px; 
            border: 2px solid #ddd; 
            border-radius: 30px; /* Rounder search bar */
            box-sizing: border-box; 
            outline: none;
            transition: all 0.3s;
        }
        .search-box:focus { 
            border-color: #42b983; 
            box-shadow: 0 0 8px rgba(66, 185, 131, 0.3);
        }
        
        #loading { text-align: center; margin-top: 20px; color: #666; font-style: italic; }
        
        #results { margin-top: 15px; max-height: 60vh; overflow-y: auto; }
        
        .card { 
            background: #fff; 
            border-bottom: 1px solid #f0f0f0; 
            padding: 15px; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            transition: background 0.2s;
        }
        .card:hover { background-color: #f9fdfb; } /* Light green hover */
        
        .name { font-weight: 600; color: #333; font-size: 16px; }
        .price { color: #27ae60; font-weight: bold; font-size: 18px; }
        
        .error-msg { color: white; background: #e74c3c; padding: 10px; border-radius: 5px; text-align: center; }
    </style>
</head>
<body>

<div class="container">
    <div class="header-banner">
        <h2>üíä Bimal Pharmacy</h2>
        <div class="subtitle">Price Search Engine</div>
    </div>
    
    <input type="text" id="searchBox" class="search-box" placeholder="Loading database..." disabled>
    
    <div id="loading">Connecting to GitHub... please wait.</div>
    <div id="results"></div>
</div>

<script>
    // ‚úÖ CORRECT LINK
    const excelUrl = "https://raw.githubusercontent.com/juction4love/bimalpharmacy/main/medicines.xlsx";

    let fuse; 

    async function loadData() {
        const loading = document.getElementById('loading');
        const searchBox = document.getElementById('searchBox');

        try {
            const response = await fetch(excelUrl);
            
            if (!response.ok) throw new Error("Could not find file on GitHub.");

            const arrayBuffer = await response.arrayBuffer();
            const data = new Uint8Array(arrayBuffer);
            const workbook = XLSX.read(data, { type: 'array' });
            const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
            const jsonData = XLSX.utils.sheet_to_json(firstSheet);

            const medicines = jsonData.map(item => ({
                name: item.Prodname ? String(item.Prodname) : "",
                price: item.S_price || "N/A"
            })).filter(item => item.name !== ""); 

            fuse = new Fuse(medicines, {
                keys: ['name'],
                threshold: 0.3, 
                ignoreLocation: true
            });

            loading.style.display = 'none';
            searchBox.disabled = false;
            searchBox.placeholder = "üîç Search Medicine Name...";
            searchBox.focus();

        } catch (error) {
            console.error(error);
            loading.innerHTML = `<div class='error-msg'>Network Error: ${error.message}<br>Refresh the page.</div>`;
        }
    }

    document.getElementById('searchBox').addEventListener('input', (e) => {
        const query = e.target.value.trim();
        const resultsDiv = document.getElementById('results');
        resultsDiv.innerHTML = '';

        if (query.length < 2) return; 

        const results = fuse.search(query);

        if (results.length > 0) {
            results.slice(0, 50).forEach(result => {
                const item = result.item;
                const price = typeof item.price === 'number' ? item.price.toFixed(2) : item.price;
                
                resultsDiv.innerHTML += `
                    <div class="card">
                        <div class="name">${item.name}</div>
                        <div class="price">Rs. ${price}</div>
                    </div>`;
            });
        } else {
            resultsDiv.innerHTML = `<div style="text-align:center; padding:20px; color:#888;">No medicine found.</div>`;
        }
    });

    window.onload = loadData;
</script>

</body>
</html>

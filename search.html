<!DOCTYPE html>
<html lang="ne">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>AI Medicine Search | Bimal Pharmacy</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <style>
    /* --- CSS Variables --- */
    :root {
      --primary: #2e7d32;
      --secondary: #1b5e20;
      --accent: #fbc02d;
      --light-bg: #f8fafc;
      --white: #ffffff;
      --gemini-color: #4285f4;
      --gemini-gradient: linear-gradient(135deg, #4285f4, #d96570);
    }

    * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
    body { background-color: var(--light-bg); padding-bottom: 80px; color: #333; }

    /* --- 1. Top Navigation (Exact Copy of Index) --- */
    .app-header {
      background: var(--white);
      padding: 15px 5%;
      position: sticky; top: 0; z-index: 1000;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
      display: flex; align-items: center; justify-content: space-between;
      flex-wrap: wrap;
    }
    .brand { font-size: 1.4rem; font-weight: 800; color: var(--primary); display: flex; align-items: center; gap: 10px; }
    .brand img { height: 45px; width: 45px; border-radius: 50%; border: 2px solid var(--primary); }

    /* Desktop Nav Links */
    .desktop-nav { display: none; } /* Hidden on mobile */
    .desktop-nav ul { display: flex; list-style: none; gap: 5px; margin: 0; padding: 0; }
    .desktop-nav a { 
      text-decoration: none; color: #555; font-weight: 600; padding: 8px 15px; 
      font-size: 0.95rem; border-radius: 5px; transition: 0.3s; 
    }
    .desktop-nav a:hover, .desktop-nav a.active { 
      background: var(--primary); color: white; 
    }

    /* --- 2. Search Section --- */
    .search-section {
      text-align: center; padding: 50px 20px;
      background: linear-gradient(to bottom, #ffffff, #f0f4f8);
      border-bottom: 1px solid #e0e0e0;
    }
    .search-title {
      font-size: 2rem; margin-bottom: 10px;
      background: var(--gemini-gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent;
    }
    
    .search-wrapper {
      max-width: 650px; margin: 25px auto 0; position: relative; display: flex; gap: 10px;
    }
    .search-input {
      width: 100%; padding: 18px 25px; border-radius: 50px;
      border: 2px solid #ddd; font-size: 1.1rem; outline: none; transition: 0.3s;
      box-shadow: 0 5px 15px rgba(0,0,0,0.05);
    }
    .search-input:focus { border-color: var(--gemini-color); box-shadow: 0 0 20px rgba(66, 133, 244, 0.15); }
    
    .btn-search {
      background: var(--gemini-gradient); color: white; border: none;
      width: 60px; height: 60px; border-radius: 50%; cursor: pointer;
      display: flex; align-items: center; justify-content: center; font-size: 1.3rem;
      transition: transform 0.2s; box-shadow: 0 5px 15px rgba(66, 133, 244, 0.3);
    }
    .btn-search:active { transform: scale(0.9); }

    /* --- 3. AI Response Box --- */
    .ai-container { max-width: 850px; margin: 30px auto; padding: 0 20px; }
    
    .ai-card {
      background: white; border-radius: 20px; padding: 30px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.08);
      border-top: 5px solid #4285f4;
      display: none; /* Hidden by default */
      animation: slideUp 0.4s ease;
    }
    .ai-header { display: flex; align-items: center; gap: 12px; margin-bottom: 20px; border-bottom: 1px solid #eee; padding-bottom: 15px; }
    .ai-header i { font-size: 2rem; color: #4285f4; }
    
    .ai-content { font-size: 1.05rem; line-height: 1.7; color: #333; }
    
    /* Loading Spinner */
    .loader { display: none; text-align: center; margin-top: 30px; }
    .spinner {
      width: 50px; height: 50px; border: 5px solid #f3f3f3;
      border-top: 5px solid var(--gemini-color); border-radius: 50%;
      animation: spin 1s linear infinite; margin: 0 auto;
    }

    /* --- 4. Mobile Bottom Nav --- */
    .mobile-nav {
      position: fixed; bottom: 0; left: 0; width: 100%;
      background: white; display: grid; grid-template-columns: repeat(5, 1fr);
      padding: 10px 0; border-top: 1px solid #eee; z-index: 1001;
      box-shadow: 0 -2px 10px rgba(0,0,0,0.05);
    }
    .nav-item { text-align: center; text-decoration: none; color: #999; font-size: 0.75rem; }
    .nav-item i { display: block; font-size: 1.4rem; margin-bottom: 4px; }
    .nav-item.active { color: var(--primary); }

    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

    /* Media Queries for Desktop */
    @media (min-width: 900px) { 
      .mobile-nav { display: none; } 
      .desktop-nav { display: block; }
      .app-header { padding: 15px 8%; }
    }
  </style>
</head>
<body>

  <header class="app-header">
    <div class="brand">
      <img src="https://raw.githubusercontent.com/juction4love/bimalpharmacy/main/logo.svg" alt="Logo">
      <span>Bimal Pharmacy</span>
    </div>
    
    <nav class="desktop-nav">
      <ul>
        <li><a href="index.html">गृहपृष्ठ</a></li>
        <li><a href="medical-guide.html">औषधी गाइड</a></li>
        <li><a href="knowledge.html">स्वास्थ्य ज्ञान</a></li>
        <li><a href="order.html">अर्डर</a></li>
        <li><a href="service.html">सेवाहरू</a></li>
        <li><a href="notice.html">सूचना</a></li>
        <li><a href="search.html" class="active"><i class="fas fa-search"></i> खोज्नुहोस्</a></li>
        <li><a href="contact.html">सम्पर्क</a></li>
        <li><a href="emergency.html" style="color:red;">आपतकालीन</a></li>
      </ul>
    </nav>
  </header>

  <section class="search-section">
    <h2 class="search-title"><i class="fas fa-robot"></i> AI Pharmacist</h2>
    <p style="color: #666; font-size: 1.1rem;">कुनै पनि औषधीको नाम लेख्नुहोस्, AI ले तुरुन्त जानकारी दिनेछ।</p>
    
    <div class="search-wrapper">
      <input type="text" id="aiInput" class="search-input" placeholder="औषधीको नाम (e.g. Paracetamol, Pantop)..." onkeypress="handleEnter(event)">
      <button onclick="fetchGeminiAnswer()" class="btn-search">
        <i class="fas fa-paper-plane"></i>
      </button>
    </div>
  </section>

  <div class="ai-container">
    <div id="loadingBox" class="loader">
      <div class="spinner"></div>
      <p style="margin-top: 15px; color: #666; font-weight: 500;">AI ले सोच्दैछ, कृपया पर्खनुहोस्...</p>
    </div>

    <div id="aiResultBox" class="ai-card">
      <div class="ai-header">
        <i class="fas fa-sparkles"></i>
        <h3 style="margin: 0;">Bimal Pharmacy AI Assistant</h3>
      </div>
      <div id="aiText" class="ai-content">
        </div>
      <div style="margin-top: 25px; padding-top: 15px; border-top: 1px dashed #ddd; font-size: 0.85rem; color: #777; text-align: center; background: #fafafa; padding: 10px; border-radius: 8px;">
        ⚠️ <strong>नोट:</strong> यो जानकारी AI प्रविधिद्वारा तयार पारिएको हो। औषधी सेवन गर्नु अघि अनिवार्य रूपमा डाक्टर वा फर्मासिस्टसँग परामर्श लिनुहोला।
      </div>
    </div>
  </div>

  <nav class="mobile-nav">
    <a href="index.html" class="nav-item"><i class="fas fa-home"></i> होम</a>
    <a href="search.html" class="nav-item active"><i class="fas fa-robot"></i> AI Search</a>
    <a href="order.html" class="nav-item"><i class="fas fa-file-prescription"></i> अर्डर</a>
    <a href="emergency.html" class="nav-item"><i class="fas fa-ambulance"></i> आपतकालीन</a>
    <a href="contact.html" class="nav-item"><i class="fas fa-user"></i> सम्पर्क</a>
  </nav>

  <script>
    // --- API CONFIGURATION ---
    // बिमल सर, यहाँ तपाईंको *नयाँ* API Key राख्नुहोला (जुनमा Website Restrictions छ)
    const API_KEY = "AIzaSyDuLk1V5MNnpEWeJBwIzwc5fFtel72abAo"; 
    // -------------------------

    function handleEnter(e) {
      if (e.key === 'Enter') fetchGeminiAnswer();
    }

    async function fetchGeminiAnswer() {
      const input = document.getElementById('aiInput').value.trim();
      const loader = document.getElementById('loadingBox');
      const resultBox = document.getElementById('aiResultBox');
      const textBox = document.getElementById('aiText');

      if (!input) return;

      // 1. Show Loading UI
      resultBox.style.display = "none";
      loader.style.display = "block";
      
      // 2. Prepare Prompt (Instructions for AI)
      const prompt = `
        Act as a professional pharmacist. Explain the medicine "${input}" in simple Nepali language for a patient.
        Structure the response strictly as follows:
        1. **औषधीको नाम:** (Correct Name)
        2. **मुख्य प्रयोग (Uses):** (Simple explanation)
        3. **कसरी खाने (Dosage):** (General rule like after food/before food)
        4. **साइड इफेक्ट (Side Effects):** (Common ones)
        5. **सावधानी (Warning):** (Who should avoid it)
        Keep sentences short and clear.
      `;

      try {
        const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${API_KEY}`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            contents: [{ parts: [{ text: prompt }] }]
          })
        });

        const data = await response.json();
        
        // 3. Hide Loader
        loader.style.display = "none";

        if (data.candidates && data.candidates[0].content) {
          const rawText = data.candidates[0].content.parts[0].text;
          
          // 4. Format Text (Bold & Line Breaks)
          const formattedText = rawText
            .replace(/\*\*(.*?)\*\*/g, '<strong style="color:var(--primary);">$1</strong>') // Make Bold Text Green
            .replace(/\*/g, '•') 
            .replace(/\n/g, '<br>');

          textBox.innerHTML = formattedText;
          resultBox.style.display = "block";
        } else {
          // Error handling specific to Key issues
          if (data.error) {
             console.error("Gemini Error:", data.error);
             alert("Google API Error: " + data.error.message);
          } else {
             alert("AI ले जवाफ दिन सकेन।");
          }
        }

      } catch (error) {
        console.error(error);
        loader.style.display = "none";
        alert("Server Error. Please check your internet connection.");
      }
    }
  </script>

</body>
</html>

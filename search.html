<!DOCTYPE html>
<html lang="ne">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Medicine Search - विमल फार्मेसी</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <style>
        :root {
            --primary-color: #2e7d32;
            --accent-color: #d32f2f;
            --bg-light: #f4f7f6;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            background-color: var(--bg-light);
            color: #333;
        }

        /* --- UPDATED DATE BANNER --- */
        .update-banner {
            background-color: #fff3cd;
            color: #856404;
            text-align: center;
            padding: 10px;
            font-size: 0.9rem;
            border-bottom: 1px solid #ffeeba;
            font-weight: bold;
        }

        header {
            background: linear-gradient(135deg, #1b5e20 0%, #43a047 100%);
            color: white;
            padding: 50px 20px;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        header h1 { font-size: 2.8rem; margin: 0; }
        
        .search-container {
            max-width: 800px;
            margin: -30px auto 40px;
            padding: 0 20px;
        }

        .search-wrapper {
            background: white;
            padding: 8px;
            border-radius: 50px;
            display: flex;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }

        #searchInput {
            flex: 1;
            border: none;
            padding: 15px 25px;
            font-size: 18px;
            outline: none;
            border-radius: 50px;
        }

        /* --- RESULTS --- */
        #searchResult {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            max-width: 1100px;
            margin: 0 auto 50px;
            padding: 0 20px;
        }

        .medicine-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            border-top: 5px solid var(--primary-color);
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .med-name {
            font-size: 1.25rem;
            font-weight: bold;
            color: #111;
            margin-bottom: 10px;
            display: block;
        }

        .med-price {
            font-size: 1.1rem;
            color: var(--accent-color);
            font-weight: 700;
            background: #fff0f0;
            padding: 5px 12px;
            border-radius: 6px;
            display: inline-block;
        }

        .med-meta {
            font-size: 0.85rem;
            color: #777;
            margin-top: 15px;
            padding-top: 10px;
            border-top: 1px dashed #ddd;
        }

        .status { text-align: center; margin-top: 15px; font-weight: bold; color: var(--primary-color); }
    </style>
</head>
<body>

    <div class="update-banner" id="updateBanner">
        अद्यावधिक गरिएको मिति: <span id="currentDate">...</span> (दरहरू समय अनुसार फरक हुन सक्छन्)
    </div>

    <header>
        <h1>विमल फार्मेसी</h1>
        <p>Medicine Price Information System</p>
    </header>

    <div class="search-container">
        <div class="search-wrapper">
            <input type="text" id="searchInput" placeholder="डाटा लोड हुँदैछ..." disabled onkeyup="instantSearch()" autocomplete="off">
        </div>
        <div id="statusMessage" class="status">प्रणाली तयारी गरिँदैछ...</div>
    </div>

    <div id="searchResult"></div>

    <script>
        let allMedicinesData = [];

        // Set the current date at the top
        document.getElementById("currentDate").innerText = new Date().toLocaleDateString('ne-NP', {
            year: 'numeric', month: 'long', day: 'numeric'
        });

        window.onload = async function() {
            const statusMsg = document.getElementById("statusMessage");
            const inputField = document.getElementById("searchInput");

            try {
                const excelUrl = 'https://raw.githubusercontent.com/juction4love/bimalpharmacy/main/medicines.xlsx';
                const response = await fetch(excelUrl);
                const arrayBuffer = await response.arrayBuffer();
                const workbook = XLSX.read(arrayBuffer, { type: 'array' });
                allMedicinesData = XLSX.utils.sheet_to_json(workbook.Sheets[workbook.SheetNames[0]]);

                statusMsg.innerText = "खोज्नको लागि औषधि वा सामानको नाम टाइप गर्नुहोस्।";
                inputField.disabled = false;
                inputField.placeholder = "औषधिको नाम लेख्नुहोस्...";
                inputField.focus();
            } catch (error) {
                statusMsg.innerHTML = "<span style='color:red'>⚠️ डाटा लोड गर्न सकिएन। इन्टरनेट चेक गर्नुहोस्।</span>";
            }
        };

        function instantSearch() {
            const input = document.getElementById("searchInput").value.toLowerCase();
            const resultsDiv = document.getElementById("searchResult");
            
            if (input.length < 2) {
                resultsDiv.innerHTML = "";
                return;
            }

            const matches = allMedicinesData.filter(row => {
                return Object.values(row).some(val => String(val).toLowerCase().includes(input));
            });

            resultsDiv.innerHTML = ""; 

            matches.slice(0, 30).forEach(item => {
                const card = document.createElement("div");
                card.className = "medicine-card";
                
                let nameHtml = "";
                let priceHtml = "";
                let metaHtml = "";

                for (const [key, value] of Object.entries(item)) {
                    const k = key.toLowerCase().trim();

                    // NO LABEL FOR NAME & PRICE
                    if (["productname", "particulars", "itemname", "product name"].includes(k)) {
                        nameHtml = `<span class="med-name">${value}</span>`;
                    } 
                    else if (["sales price", "salesprice", "price", "rate", "mrp"].includes(k)) {
                        priceHtml = `<span class="med-price">रू. ${value}</span>`;
                    }
                    else if (!["sn", "unit"].includes(k)) {
                        metaHtml += `<div><strong>${key}:</strong> ${value}</div>`;
                    }
                }

                card.innerHTML = `
                    <div>
                        ${nameHtml}
                        ${priceHtml}
                    </div>
                    <div class="med-meta">
                        ${metaHtml}
                    </div>
                `;
                resultsDiv.appendChild(card);
            });
        }
    </script>
</body>
</html>

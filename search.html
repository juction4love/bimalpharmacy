<!DOCTYPE html>
<html lang="ne">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>IME Life AI Agent | Bimal Pharmacy</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <style>
    /* --- CSS Variables (Design Settings) --- */
    :root {
      --primary: #2e7d32; /* Pharmacy Green */
      --ime-red: #ed1c24; /* IME Life Red */
      --light-bg: #f8fafc;
      --white: #ffffff;
      --gemini-gradient: linear-gradient(135deg, #ed1c24, #fbc02d);
    }

    * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
    body { background-color: var(--light-bg); padding-bottom: 80px; color: #333; }

    /* --- 1. HEADER & NAVIGATION --- */
    .app-header {
      background: var(--white); padding: 10px 3%;
      position: sticky; top: 0; z-index: 1000;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
      display: flex; justify-content: space-between; align-items: center;
    }
    .brand { font-size: 1.4rem; font-weight: 800; color: var(--primary); display: flex; align-items: center; gap: 10px; }
    .brand img { height: 45px; width: 45px; border-radius: 50%; border: 2px solid var(--primary); }

    /* Desktop Navigation (Hidden on Mobile) */
    .desktop-nav { display: none; }
    .desktop-nav ul { display: flex; list-style: none; gap: 15px; margin: 0; padding: 0; align-items: center; }
    .desktop-nav a { 
      text-decoration: none; color: #555; font-weight: 600; padding: 8px 12px; 
      font-size: 0.95rem; border-radius: 5px; transition: 0.3s; white-space: nowrap;
    }
    .desktop-nav a:hover { background-color: #e8f5e9; color: var(--primary); }
    .desktop-nav a.active { background-color: var(--ime-red); color: white; }

    /* --- 2. SEARCH SECTION --- */
    .search-section {
      text-align: center; padding: 60px 20px;
      background: white; border-bottom: 1px solid #ddd;
    }
    .ime-logo-text {
      color: var(--ime-red); font-weight: 800; font-size: 2.5rem;
      text-transform: uppercase; letter-spacing: 1px; margin-bottom: 10px;
    }
    
    .search-wrapper {
      max-width: 650px; margin: 30px auto 0; position: relative; display: flex; gap: 10px;
    }
    .search-input {
      width: 100%; padding: 18px 25px; border-radius: 50px;
      border: 2px solid #ddd; font-size: 1.1rem; outline: none; transition: 0.3s;
    }
    .search-input:focus { border-color: var(--ime-red); box-shadow: 0 0 15px rgba(237, 28, 36, 0.1); }
    
    .btn-search {
      background: var(--gemini-gradient); color: white; border: none;
      width: 60px; height: 60px; border-radius: 50%; cursor: pointer;
      display: flex; align-items: center; justify-content: center; font-size: 1.4rem;
      transition: transform 0.2s;
    }
    .btn-search:active { transform: scale(0.95); }

    /* --- 3. RESULT BOX --- */
    .ai-container { max-width: 800px; margin: 30px auto; padding: 0 20px; }
    .ai-card {
      background: white; border-radius: 20px; padding: 30px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.05);
      border-top: 5px solid var(--ime-red);
      display: none; /* Initially Hidden */
    }
    .ai-header { display:flex; align-items:center; gap:10px; margin-bottom:20px; border-bottom:1px solid #eee; padding-bottom:15px; }
    .ai-content { font-size: 1.05rem; line-height: 1.8; color: #444; }
    
    /* Loader Animation */
    .loader { display: none; text-align: center; margin-top: 40px; }
    .spinner {
      width: 50px; height: 50px; border: 5px solid #f3f3f3;
      border-top: 5px solid var(--ime-red); border-radius: 50%;
      animation: spin 1s linear infinite; margin: 0 auto;
    }

    /* --- 4. MOBILE NAVIGATION (Bottom Bar) --- */
    .mobile-nav {
      position: fixed; bottom: 0; left: 0; width: 100%;
      background: white; display: grid; grid-template-columns: repeat(5, 1fr);
      padding: 12px 0; border-top: 1px solid #eee; z-index: 1001;
      box-shadow: 0 -2px 10px rgba(0,0,0,0.05);
    }
    .nav-item { text-align: center; text-decoration: none; color: #999; font-size: 0.75rem; }
    .nav-item i { display: block; font-size: 1.4rem; margin-bottom: 5px; }
    .nav-item.active { color: var(--ime-red); }

    /* Animation & Responsive Logic */
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    
    /* Desktop View Trigger */
    @media (min-width: 900px) { 
        .mobile-nav { display: none; } 
        .desktop-nav { display: block; } 
    }
  </style>
</head>
<body>

  <header class="app-header">
    <div class="brand">
      <img src="https://raw.githubusercontent.com/juction4love/bimalpharmacy/main/logo.svg" alt="Logo">
      <span>Bimal Pharmacy</span>
    </div>
    
    <nav class="desktop-nav">
      <ul>
        <li><a href="index.html">गृहपृष्ठ</a></li>
        <li><a href="medical-guide.html">औषधी गाइड</a></li>
        <li><a href="knowledge.html">स्वास्थ्य ज्ञान</a></li>
        <li><a href="order.html">अर्डर</a></li>
        <li><a href="service.html">सेवाहरू</a></li>
        <li><a href="notice.html">सूचना</a></li>
        <li><a href="search.html" class="active"><i class="fas fa-search"></i> खोज्नुहोस्</a></li> 
        <li><a href="contact.html">सम्पर्क</a></li>
        <li><a href="emergency.html" style="color:#d32f2f;">आपतकालीन</a></li>
      </ul>
    </nav>
  </header>

  <section class="search-section">
    <h2 class="ime-logo-text">IME Life Insurance</h2>
    <p style="color: #666; font-size: 1.1rem;">तपाईंको भविष्यको सुरक्षा, हाम्रो जिम्मेवारी।</p>
    
    <div class="search-wrapper">
      <input type="text" id="aiInput" class="search-input" placeholder="प्रश्न सोध्नुहोस् " onkeypress="handleEnter(event)">
      <button onclick="fetchGeminiAnswer()" class="btn-search">
        <i class="fas fa-paper-plane"></i>
      </button>
    </div>
  </section>

  <div class="ai-container">
    <div id="loadingBox" class="loader">
      <div class="spinner"></div>
      <p style="margin-top: 15px; color: #666; font-weight: 500;">तपाईंको लागि योजना खोज्दै...</p>
    </div>

    <div id="aiResultBox" class="ai-card">
      <div class="ai-header">
        <i class="fas fa-shield-alt" style="font-size:1.8rem; color:var(--ime-red);"></i>
        <div>
            <h3 style="color:#333; margin-bottom:2px;">IME Life जानकारी</h3>
            <span style="font-size:0.8rem; color:#888;">AI Assistant Active</span>
        </div>
      </div>
      
      <div id="aiText" class="ai-content"></div>
      
      <div style="margin-top: 25px; font-size: 0.9rem; color: #555; text-align: center; background:#fff5f5; padding:15px; border-radius:10px; border: 1px dashed var(--ime-red);">
        <strong>सम्पर्क:</strong> बिमल लामिछाने (IME Life अभिकर्ता)<br>
        <span style="font-size:0.8rem; color:#888;">*यो जानकारी AI ले तयार पारेको हो। आधिकारिक पोलिसीको लागि सम्पर्क गर्नुहोस्।</span>
      </div>
    </div>
  </div>

  <nav class="mobile-nav">
    <a href="index.html" class="nav-item"><i class="fas fa-home"></i> होम</a>
    <a href="search.html" class="nav-item active"><i class="fas fa-robot"></i> AI Agent</a>
    <a href="order.html" class="nav-item"><i class="fas fa-file-prescription"></i> अर्डर</a>
    <a href="emergency.html" class="nav-item"><i class="fas fa-ambulance"></i> आपतकालीन</a>
    <a href="contact.html" class="nav-item"><i class="fas fa-user"></i> सम्पर्क</a>
  </nav>

  <script>
    // --- FINAL API CONFIGURATION ---
    // बिमल सरको नयाँ Key (Restricted to bimalpharmacy.com.np)
    const API_KEY = "AIzaSyBly_wvcUIeFdcfpvNKgo1co98EHcQTwdE"; 
    // -------------------------------

    function handleEnter(e) {
      if (e.key === 'Enter') fetchGeminiAnswer();
    }

    async function fetchGeminiAnswer() {
      const input = document.getElementById('aiInput').value.trim();
      const loader = document.getElementById('loadingBox');
      const resultBox = document.getElementById('aiResultBox');
      const textBox = document.getElementById('aiText');

      if (!input) return;

      // 1. Reset UI
      resultBox.style.display = "none";
      loader.style.display = "block";
      
      // 2. Prepare the Insurance Prompt
      const prompt = `
        Act as a professional insurance agent for "IME Life Insurance Nepal".
        Answer the following query in simple Nepali language: "${input}"
        
        If the user asks about a specific policy , structure the answer as:
        1. **योजनाको नाम (Plan Name):**
        2. **मुख्य फाइदा (Benefits):** (Bonus, Risk Cover)
        3. **आवश्यकता (Requirements):** (Age, Term)
        4. **किन यो राम्रो छ?**

        If the query is general, explain why insurance is important for family safety.
        Tone: Polite, Professional, Convincing.
        IMPORTANT: Do NOT mention you are an AI. Act as Bimal Lamichhane's digital assistant.
      `;

      try {
        // 3. Call Google Gemini API (Using gemini-1.5-flash)
        const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${API_KEY}`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
        });

        const data = await response.json();
        
        // 4. Hide Loader
        loader.style.display = "none";

        // 5. Check for Errors
        if (data.error) {
            console.error("API Error Details:", data.error);
            alert("System Error: " + data.error.message);
            return;
        }

        // 6. Display Result
        if (data.candidates && data.candidates[0].content) {
          const rawText = data.candidates[0].content.parts[0].text;
          
          // Formatting (Bold Red for Emphasis)
          const formattedText = rawText
            .replace(/\*\*(.*?)\*\*/g, '<strong style="color:#ed1c24;">$1</strong>')
            .replace(/\*/g, '•') 
            .replace(/\n/g, '<br>');

          textBox.innerHTML = formattedText;
          resultBox.style.display = "block";
        } else {
          alert("माफ गर्नुहोस्, कुनै जानकारी भेटिएन। कृपया अर्को प्रश्न सोध्नुहोस्।");
        }

      } catch (error) {
        console.error("Network Error:", error);
        loader.style.display = "none";
        alert("इन्टरनेट समस्या भयो। कृपया पेज रिफ्रेस गर्नुहोस्।");
      }
    }
  </script>
</body>
</html>

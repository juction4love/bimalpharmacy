<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bimal Pharmacy Search</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.6.2/fuse.min.js"></script>
    
    <style>
        /* ‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§∞ ‡§≤‡•ç‡§Ø‡§æ‡§™‡§ü‡§™ ‡§¶‡•Å‡§¨‡•à‡§Æ‡§æ ‡§∞‡§æ‡§Æ‡•ç‡§∞‡•ã ‡§¶‡•á‡§ñ‡§ø‡§®‡•á ‡§°‡§ø‡§ú‡§æ‡§á‡§® */
        body { font-family: 'Segoe UI', sans-serif; background-color: #f4f7f6; margin: 0; padding: 15px; }
        .container { max-width: 600px; margin: 0 auto; background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        h2 { text-align: center; color: #2c3e50; margin-bottom: 20px; }
        
        /* ‡§∏‡§∞‡•ç‡§ö ‡§¨‡§ï‡•ç‡§∏‡§ï‡•ã ‡§°‡§ø‡§ú‡§æ‡§á‡§® */
        .search-box {
            width: 100%; padding: 15px; font-size: 18px; 
            border: 2px solid #ddd; border-radius: 8px; 
            box-sizing: border-box; outline: none;
        }
        .search-box:focus { border-color: #3498db; }
        
        /* ‡§≤‡•ã‡§°‡§ø‡§ô ‡§Æ‡•ç‡§Ø‡§æ‡§∏‡•á‡§ú */
        #loading { text-align: center; margin-top: 20px; color: #666; font-style: italic; }
        
        /* ‡§®‡§§‡§ø‡§ú‡§æ ‡§¶‡•á‡§ñ‡§æ‡§â‡§®‡•á ‡§≤‡§ø‡§∏‡•ç‡§ü */
        #results { margin-top: 15px; max-height: 65vh; overflow-y: auto; }
        .card { 
            background: #fff; border-bottom: 1px solid #f0f0f0; 
            padding: 12px; display: flex; justify-content: space-between; align-items: center; 
        }
        .card:last-child { border-bottom: none; }
        .name { font-weight: 600; color: #333; font-size: 16px; }
        .price { color: #27ae60; font-weight: bold; font-size: 18px; }
        
        /* ‡§ï‡•á‡§π‡•Ä ‡§®‡§≠‡•á‡§ü‡§ø‡§è‡§Æ‡§æ */
        .no-result { text-align: center; padding: 20px; color: #e74c3c; }
    </style>
</head>
<body>

<div class="container">
    <h2>üè• Bimal Pharmacy Price</h2>
    
    <input type="text" id="searchBox" class="search-box" placeholder="Loading data..." disabled>
    
    <div id="loading">Connecting to GitHub... please wait.</div>
    <div id="results"></div>
</div>

<script>
    // ‡§§‡§™‡§æ‡§à‡§Ç‡§ï‡•ã GitHub ‡§ï‡•ã ‡§≤‡§ø‡§Ç‡§ï
    const excelUrl = "https://github.com/juction4love/bimalpharmacy/raw/refs/heads/main/medicines.xlsx";

    let fuse; // ‡§∏‡§∞‡•ç‡§ö ‡§á‡§®‡•ç‡§ú‡§ø‡§®

    // ‡•ß. ‡§°‡•á‡§ü‡§æ ‡§§‡§æ‡§®‡•ç‡§®‡•á ‡§´‡§®‡•ç‡§ï‡•ç‡§∏‡§®
    async function loadData() {
        const loading = document.getElementById('loading');
        const searchBox = document.getElementById('searchBox');

        try {
            // GitHub ‡§¨‡§æ‡§ü ‡§´‡§æ‡§á‡§≤ ‡§Æ‡§æ‡§ó‡•ç‡§®‡•á
            const response = await fetch(excelUrl);
            
            if (!response.ok) throw new Error("Could not fetch file from GitHub.");

            // ‡§´‡§æ‡§á‡§≤ ‡§™‡§¢‡•ç‡§®‡•á (Binary Data)
            const arrayBuffer = await response.arrayBuffer();
            const data = new Uint8Array(arrayBuffer);
            const workbook = XLSX.read(data, { type: 'array' });

            // ‡§™‡§π‡§ø‡§≤‡•ã ‡§∏‡§ø‡§ü (Sheet) ‡§≤‡§ø‡§®‡•á
            const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
            const jsonData = XLSX.utils.sheet_to_json(firstSheet);

            // ‡§°‡•á‡§ü‡§æ ‡§∏‡§´‡§æ ‡§ó‡§∞‡•ç‡§®‡•á (Prodname ‡§∞ S_price ‡§Æ‡§æ‡§§‡•ç‡§∞ ‡§≤‡§ø‡§®‡•á)
            const medicines = jsonData.map(item => ({
                name: item.Prodname ? String(item.Prodname) : "",
                price: item.S_price || "N/A"
            })).filter(item => item.name !== ""); // ‡§®‡§æ‡§Æ ‡§®‡§≠‡§è‡§ï‡•ã ‡§π‡§ü‡§æ‡§â‡§®‡•á

            // Fuse Search ‡§§‡§Ø‡§æ‡§∞ ‡§ó‡§∞‡•ç‡§®‡•á (‡§∞‡§æ‡§Æ‡•ç‡§∞‡•ã ‡§∏‡§∞‡•ç‡§ö‡§ï‡•ã ‡§≤‡§æ‡§ó‡§ø)
            fuse = new Fuse(medicines, {
                keys: ['name'],
                threshold: 0.3, // ‡§Ö‡§≤‡§ø‡§Ö‡§≤‡§ø ‡§∏‡•ç‡§™‡•á‡§≤‡§ø‡§ô ‡§¨‡§ø‡§ó‡•ç‡§∞‡§ø‡§è ‡§™‡§®‡§ø ‡§¨‡•Å‡§ù‡•ç‡§®‡•á
                ignoreLocation: true
            });

            // ‡§∏‡§¨ ‡§†‡§ø‡§ï ‡§≠‡§è‡§™‡§õ‡§ø
            loading.style.display = 'none';
            searchBox.disabled = false;
            searchBox.placeholder = "Search Medicine Name...";
            searchBox.focus();

        } catch (error) {
            console.error(error);
            loading.innerHTML = `<span style='color:red'>Error loading data! Please check your internet connection.</span>`;
        }
    }

    // ‡•®. ‡§∏‡§∞‡•ç‡§ö ‡§ó‡§∞‡•ç‡§¶‡§æ ‡§ï‡•á ‡§ó‡§∞‡•ç‡§®‡•á?
    document.getElementById('searchBox').addEventListener('input', (e) => {
        const query = e.target.value.trim();
        const resultsDiv = document.getElementById('results');
        resultsDiv.innerHTML = '';

        if (query.length < 2) return; // ‡•® ‡§Ö‡§ï‡•ç‡§∑‡§∞ ‡§≠‡§®‡•ç‡§¶‡§æ ‡§ï‡§Æ ‡§ü‡§æ‡§á‡§™ ‡§ó‡§∞‡•á ‡§ï‡•á‡§π‡•Ä ‡§®‡§ó‡§∞‡•ç‡§®‡•á

        const results = fuse.search(query);

        if (results.length > 0) {
            // ‡•´‡•¶ ‡§µ‡§ü‡§æ ‡§≠‡§®‡•ç‡§¶‡§æ ‡§¨‡§¢‡•Ä ‡§®‡§¶‡•á‡§ñ‡§æ‡§â‡§®‡•á (‡§π‡•ç‡§Ø‡§æ‡§ô ‡§®‡§π‡•ã‡§∏‡•ç ‡§≠‡§®‡•á‡§∞)
            results.slice(0, 50).forEach(result => {
                const item = result.item;
                const price = typeof item.price === 'number' ? item.price.toFixed(2) : item.price;
                
                resultsDiv.innerHTML += `
                    <div class="card">
                        <div class="name">${item.name}</div>
                        <div class="price">Rs. ${price}</div>
                    </div>`;
            });
        } else {
            resultsDiv.innerHTML = `<div class="no-result">Medicine not found in list.</div>`;
        }
    });

    // ‡§™‡•á‡§ú ‡§ñ‡•Å‡§≤‡•ç‡§¶‡§æ ‡§°‡•á‡§ü‡§æ ‡§≤‡•ã‡§° ‡§∏‡•Å‡§∞‡•Å ‡§ó‡§∞‡•ç‡§®‡•á
    window.onload = loadData;
</script>

</body>
</html>

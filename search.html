<script>
        // ============================================
        // 1. EXCEL DATABASE SEARCH LOGIC
        // ============================================
        async function performSearch() {
            var query = document.getElementById("searchInput").value.toLowerCase();
            var resultsDiv = document.getElementById("searchResult");
            
            if (!query) {
                alert("Please enter a medicine name.");
                return;
            }

            resultsDiv.innerHTML = "<p>Reading database...</p>";

            try {
                // ‚úÖ UPDATED: The Direct Raw Link (Better for websites)
                const excelUrl = 'https://raw.githubusercontent.com/juction4love/bimalpharmacy/main/medicines.xlsx';
                
                const response = await fetch(excelUrl);
                
                if (!response.ok) {
                    throw new Error("Network response was not ok");
                }

                // Parse Excel
                const arrayBuffer = await response.arrayBuffer();
                const workbook = XLSX.read(arrayBuffer, { type: 'array' });
                const firstSheetName = workbook.SheetNames[0];
                const worksheet = workbook.Sheets[firstSheetName];
                const jsonData = XLSX.utils.sheet_to_json(worksheet);

                // Filter Data
                const filteredData = jsonData.filter(row => {
                    return Object.values(row).some(val => 
                        String(val).toLowerCase().includes(query)
                    );
                });

                // Display Results
                if (filteredData.length > 0) {
                    resultsDiv.innerHTML = ""; 
                    filteredData.forEach(item => {
                        var div = document.createElement("div");
                        div.className = "result-item";
                        
                        let displayString = "";
                        // Loop through columns (Name, Price, etc.)
                        for (const [key, value] of Object.entries(item)) {
                            // Style the output
                            displayString += `<strong>${key}:</strong> ${value} &nbsp; | &nbsp; `;
                        }
                        div.innerHTML = displayString;
                        resultsDiv.appendChild(div);
                    });
                } else {
                    resultsDiv.innerHTML = "<p style='color:red;'>‚ùå Medicine not found. Please order below.</p>";
                }

            } catch (error) {
                console.error("Error:", error);
                // Helpful error message for you
                if(window.location.protocol === "file:") {
                     resultsDiv.innerHTML = "<p style='color:red;'>‚ö†Ô∏è <strong>System Error:</strong> You are opening this file directly on your computer.<br>Please <strong>Upload this file to your Website/GitHub</strong> to test the database.</p>";
                } else {
                     resultsDiv.innerHTML = "<p style='color:red;'>System Error: " + error.message + "</p>";
                }
            }
        }


        // ============================================
        // 2. EMAIL ORDER LOGIC
        // ============================================
        function sendOrderEmail() {
            var name = document.getElementById("reqName").value;
            var mobile = document.getElementById("reqMobile").value;
            var address = document.getElementById("reqAddress").value;
            var medicine = document.getElementById("reqMedicine").value;

            if(mobile === "") {
                alert("Please enter Mobile Number");
                return;
            }

            var emailTo = "contact@bimalpharmacy.com.np"; 
            var subject = "Order Request - " + name;
            
            var body = "Namaste Bimal Pharmacy,%0D%0A%0D%0A" +
                       "I want to order medicines:%0D%0A" +
                       "--------------------------------%0D%0A" +
                       "üë§ Name: " + name + "%0D%0A" +
                       "üìû Mobile: " + mobile + "%0D%0A" +
                       "üìç Address: " + address + "%0D%0A" +
                       "üíä Medicine: " + medicine + "%0D%0A" +
                       "--------------------------------";

            window.location.href = "mailto:" + emailTo + "?subject=" + subject + "&body=" + body;

            setTimeout(function() {
                alert("Your email app is opening...");
            }, 500);
        }
    </script>

<main class="main-content">
  <div class="card" style="grid-column: 1 / -1; text-align: center; border-top-color: var(--primary); padding: 30px;">
    <h2><i class="fas fa-search"></i> औषधी वा सेवा खोज्नुहोस्</h2>
    <p style="color: #666; margin-bottom: 20px;">700+ सामान्य औषधी, अंकोलोजी, र सर्जिकल सामानहरू उपलब्ध छन्</p>
    <div style="margin: 25px 0;">
      <input type="text" id="medicineSearch" placeholder="खोज्नुहोस् (जस्तै: 1000-D, Oncology, Vitamin)..." 
             style="width: 100%; max-width: 600px; padding: 18px; border-radius: 50px; border: 2px solid #e1e8ed; font-size: 18px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); outline: none;">
    </div>
    <div id="searchStats" style="font-size: 14px; color: #888;"></div>
  </div>

  <div id="resultsList" style="grid-column: 1 / -1; display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 20px;">
    </div>
</main>

<script>
  let medicines = [];
  const resultsContainer = document.getElementById('resultsList');
  const searchInput = document.getElementById('medicineSearch');
  const statsContainer = document.getElementById('searchStats');

  // Load the 700+ medicine data
  async function loadMedicineData() {
    try {
      // Ensure this filename matches the one generated by your Python script
      const response = await fetch('medicine.json'); 
      medicines = await response.json();
      displayMedicines(); // Initial display
    } catch (error) {
      console.error("Error loading medicine data:", error);
      resultsContainer.innerHTML = '<p style="grid-column: 1/-1; text-align: center; color: red;">डाटा लोड गर्न सकिएन। कृपया फाइलको नाम जाँच्नुहोस्।</p>';
    }
  }

  function displayMedicines(filter = '') {
    resultsContainer.innerHTML = ''; 
    const query = filter.toLowerCase().trim();
    
    // Fixed logic to match your new JSON fields
    const filtered = medicines.filter(item => 
      item.Product.toLowerCase().includes(query) || 
      item.Category.toLowerCase().includes(query) ||
      item.Use_for.toLowerCase().includes(query)
    );

    // Performance: Only show first 100 results to keep the browser fast
    const itemsToShow = filtered.slice(0, 100);
    statsContainer.innerText = `नतिजा: ${filtered.length} वटा भेटिए`;

    itemsToShow.forEach(item => {
      const card = document.createElement('div');
      card.className = 'card';
      // Style to match your pharmacy branding
      card.style = "border-left: 5px solid var(--primary); padding: 20px; transition: transform 0.2s;";
      
      card.innerHTML = `
        <div style="display: flex; justify-content: space-between; align-items: flex-start;">
          <span style="font-size: 11px; background: #f0f0f0; padding: 2px 8px; border-radius: 10px; color: #555; font-weight: bold;">
            ${item.Category.toUpperCase()}
          </span>
          <span style="color: var(--primary); font-weight: bold;">Rs. ${item.S_price}</span>
        </div>
        
        <h3 style="margin: 10px 0; color: #333;">${item.Product}</h3>
        
        <p style="font-size: 14px; color: #444; margin-bottom: 8px;">
          <strong>प्रयोग:</strong> ${item.Use_for}
        </p>
        
        <p style="font-size: 13px; color: #777; font-style: italic;">
          <strong>साइड इफेक्ट:</strong> ${item.Side_effects.join(', ')}
        </p>

        <div style="margin-top: 15px; border-top: 1px solid #eee; padding-top: 10px; text-align: right;">
           <a href="https://wa.me/97798XXXXXXXX?text=I want to order ${item.Product}" 
              style="text-decoration: none; background: #25D366; color: white; padding: 8px 15px; border-radius: 5px; font-size: 14px;">
              <i class="fab fa-whatsapp"></i> अर्डर गर्नुहोस्
           </a>
        </div>
      `;
      resultsContainer.appendChild(card);
    });

    if (filtered.length === 0) {
      resultsContainer.innerHTML = `
        <div style="grid-column: 1/-1; text-align: center; padding: 40px;">
          <i class="fas fa-pills" style="font-size: 40px; color: #ccc; margin-bottom: 10px;"></i>
          <p>माफ गर्नुहोला, तपाईंले खोज्नुभएको औषधी "<strong>${filter}</strong>" भेटिएन।</p>
        </div>`;
    }
  }

  // Initial load when page opens
  loadMedicineData();

  // Optimized Search listener with small delay (debounce) for performance
  let searchTimeout;
  searchInput.addEventListener('input', (e) => {
    clearTimeout(searchTimeout);
    searchTimeout = setTimeout(() => {
      displayMedicines(e.target.value);
    }, 200); 
  });
</script>

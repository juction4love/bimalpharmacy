<script>
    // --- API CONFIGURATION ---
    // बिमल सरको नयाँ Key यहाँ छ:
    const API_KEY = "AIzaSyBly_wvcUIeFdcfpvNKgo1co98EHcQTwdE"; 
    // -------------------------

    function handleEnter(e) {
      if (e.key === 'Enter') fetchGeminiAnswer();
    }

    async function fetchGeminiAnswer() {
      const input = document.getElementById('aiInput').value.trim();
      const loader = document.getElementById('loadingBox');
      const resultBox = document.getElementById('aiResultBox');
      const textBox = document.getElementById('aiText');

      if (!input) return;

      // 1. Show Loading UI
      resultBox.style.display = "none";
      loader.style.display = "block";
      
      // 2. Prepare Prompt
      const prompt = `
        Act as a professional pharmacist. Explain the medicine "${input}" in simple Nepali language for a patient.
        Structure the response strictly as follows:
        1. **औषधीको नाम:** (Correct Name)
        2. **मुख्य प्रयोग (Uses):** (Simple explanation)
        3. **कसरी खाने (Dosage):** (General rule like after food/before food)
        4. **साइड इफेक्ट (Side Effects):** (Common ones)
        5. **सावधानी (Warning):** (Who should avoid it)
        Keep sentences short and clear.
      `;

      try {
        // --- CHANGE HERE: Used 'gemini-pro' instead of 'gemini-1.5-flash' ---
        const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${API_KEY}`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            contents: [{ parts: [{ text: prompt }] }]
          })
        });

        const data = await response.json();
        
        // 3. Hide Loader
        loader.style.display = "none";

        if (data.error) {
            console.error("API Error:", data.error);
            alert("Google API Error: " + data.error.message);
            return;
        }

        if (data.candidates && data.candidates[0].content) {
          const rawText = data.candidates[0].content.parts[0].text;
          
          // 4. Format Text
          const formattedText = rawText
            .replace(/\*\*(.*?)\*\*/g, '<strong style="color:var(--primary);">$1</strong>') 
            .replace(/\*/g, '•') 
            .replace(/\n/g, '<br>');

          textBox.innerHTML = formattedText;
          resultBox.style.display = "block";
        } else {
          alert("माफ गर्नुहोस्, नेटवर्क समस्या भयो। फेरि प्रयास गर्नुहोस्।");
        }

      } catch (error) {
        console.error(error);
        loader.style.display = "none";
        alert("Server Error. Please check your internet.");
      }
    }
  </script>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bimal Pharmacy Search</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.6.2/fuse.min.js"></script>
    
    <style>
        body { 
            font-family: 'Segoe UI', sans-serif; 
            background-color: #f4f7f6; 
            margin: 0; 
            padding: 20px; 
        }
        .container { 
            max-width: 600px; 
            margin: 0 auto; 
            background: white; 
            padding: 20px; 
            border-radius: 12px; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.1); 
        }
        h2 { 
            text-align: center; 
            color: #2c3e50; 
            margin-bottom: 20px; 
        }
        .search-box {
            width: 100%; 
            padding: 15px; 
            font-size: 18px; 
            border: 2px solid #ddd; 
            border-radius: 8px; 
            box-sizing: border-box; 
            outline: none;
        }
        .search-box:focus { border-color: #3498db; }
        
        #loading { text-align: center; margin-top: 20px; color: #666; font-style: italic; }
        #results { margin-top: 15px; max-height: 65vh; overflow-y: auto; }
        
        .card { 
            background: #fff; 
            border-bottom: 1px solid #f0f0f0; 
            padding: 15px; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
        }
        .name { font-weight: 600; color: #333; font-size: 16px; }
        .price { color: #27ae60; font-weight: bold; font-size: 18px; }
        .error-msg { color: red; text-align: center; margin-top: 10px; }
    </style>
</head>
<body>

<div class="container">
    <h2>ðŸ’Š Bimal Pharmacy Price List</h2>
    
    <input type="text" id="searchBox" class="search-box" placeholder="Loading database..." disabled>
    
    <div id="loading">Connecting to GitHub... please wait.</div>
    <div id="results"></div>
</div>

<script>
    // âœ… CORRECTED LINK (Do not change this)
    const excelUrl = "https://raw.githubusercontent.com/juction4love/bimalpharmacy/main/medicines.xlsx";

    let fuse; 

    async function loadData() {
        const loading = document.getElementById('loading');
        const searchBox = document.getElementById('searchBox');

        try {
            const response = await fetch(excelUrl);
            
            if (!response.ok) throw new Error("Could not find file on GitHub.");

            const arrayBuffer = await response.arrayBuffer();
            const data = new Uint8Array(arrayBuffer);
            const workbook = XLSX.read(data, { type: 'array' });
            const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
            const jsonData = XLSX.utils.sheet_to_json(firstSheet);

            const medicines = jsonData.map(item => ({
                name: item.Prodname ? String(item.Prodname) : "",
                price: item.S_price || "N/A"
            })).filter(item => item.name !== ""); 

            fuse = new Fuse(medicines, {
                keys: ['name'],
                threshold: 0.3, 
                ignoreLocation: true
            });

            loading.style.display = 'none';
            searchBox.disabled = false;
            searchBox.placeholder = "Type medicine name here...";
            searchBox.focus();

        } catch (error) {
            console.error(error);
            loading.innerHTML = `<div class='error-msg'>Network Error: ${error.message}<br>Please refresh the page.</div>`;
        }
    }

    document.getElementById('searchBox').addEventListener('input', (e) => {
        const query = e.target.value.trim();
        const resultsDiv = document.getElementById('results');
        resultsDiv.innerHTML = '';

        if (query.length < 2) return; 

        const results = fuse.search(query);

        if (results.length > 0) {
            results.slice(0, 50).forEach(result => {
                const item = result.item;
                const price = typeof item.price === 'number' ? item.price.toFixed(2) : item.price;
                
                resultsDiv.innerHTML += `
                    <div class="card">
                        <div class="name">${item.name}</div>
                        <div class="price">Rs. ${price}</div>
                    </div>`;
            });
        } else {
            resultsDiv.innerHTML = `<div style="text-align:center; padding:20px; color:red;">No medicine found.</div>`;
        }
    });

    window.onload = loadData;
</script>

</body>
</html>

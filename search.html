<!DOCTYPE html>
<html lang="ne">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>औषधी खोज्नुहोस् | विमल फार्मेसी</title>
  
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  
  <style>
    :root {
        --primary: #2e7d32; 
        --accent: #fbc02d;
    }
    .search-container { max-width: 1000px; margin: 20px auto; padding: 0 15px; min-height: 70vh; }
    
    .search-box-wrapper {
        position: sticky;
        top: 10px;
        z-index: 100;
        background: white;
        padding: 15px 0;
    }

    #medInput {
        width: 100%;
        padding: 15px 20px 15px 50px;
        font-size: 1.1rem;
        border: 2px solid var(--primary);
        border-radius: 50px;
        outline: none;
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    .search-icon-inside {
        position: absolute;
        left: 20px;
        top: 50%;
        transform: translateY(-50%);
        color: var(--primary);
        font-size: 1.2rem;
    }

    .results-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin-top: 20px;
    }

    .med-card {
        background: #fff;
        padding: 20px;
        border-radius: 12px;
        border-top: 4px solid var(--primary);
        box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        display: flex;
        flex-direction: column;
        justify-content: space-between;
    }

    .med-card h3 { color: #333; margin: 10px 0; font-size: 1.1rem; text-transform: uppercase; }
    
    .tag-row { display: flex; justify-content: space-between; align-items: center; }
    
    .category-badge {
        font-size: 0.75rem;
        background: #e8f5e9;
        color: var(--primary);
        padding: 4px 10px;
        border-radius: 20px;
        font-weight: bold;
    }

    .price-tag { font-size: 1.2rem; font-weight: bold; color: #d32f2f; margin: 10px 0; }
    
    .btn-group { display: flex; gap: 10px; margin-top: 15px; }
    
    .card-btn {
        flex: 1;
        padding: 10px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        text-decoration: none;
        font-size: 0.9rem;
        text-align: center;
        font-weight: bold;
    }
    
    .call-btn { background: var(--primary); color: white; }
    .wa-btn { background: #25D366; color: white; }

    #status-msg { text-align: center; padding: 20px; color: #666; font-style: italic; }
  </style>
</head>
<body>

  <header class="text-header">
    <h1>विमल फार्मेसी</h1>
    <p><i class="fas fa-map-marker-alt"></i> क्यान्सर अस्पताल रोड, भरतपुर-७, चितवन | <i class="fas fa-phone"></i> ०५६-५९३२८८</p>
  </header>

  <nav class="navbar">
    <ul class="nav-links">
      <li><a href="index.html">गृहपृष्ठ</a></li>
      <li><a href="search.html" class="active">खोज्नुहोस्</a></li>
      <li><a href="order.html">अर्डर गर्नुहोस्</a></li>
      <li><a href="service.html">सेवाहरू</a></li>
      <li><a href="notice.html">सूचना</a></li>
      <li><a href="contact.html">सम्पर्क</a></li>
    </ul>
  </nav>

  <main class="search-container">
    <div style="text-align:center; padding: 20px 0;">
        <h2 style="color: var(--primary);">डिजिटल औषधी सूची</h2>
        <p>नाम, श्रेणी (Oncology, Vitamin) वा प्रयोग अनुसार खोज्नुहोस्।</p>
    </div>

    <div class="search-box-wrapper">
        <i class="fas fa-search search-icon-inside"></i>
        <input type="text" id="medInput" placeholder="औषधीको नाम यहाँ लेख्नुहोस्..." oninput="debounceSearch()">
    </div>

    <div id="status-msg">डाटा लोड हुँदैछ...</div>
    <div id="resultsGrid" class="results-grid"></div>
  </main>

  <footer>
    <div class="footer-info">
      <strong>विमल फार्मेसी</strong><br>
      क्यान्सर अस्पताल रोड, भरतपुर-७, चितवन<br>
      <i class="fas fa-phone"></i> ०५६-५९३२८८
    </div>
    <p>&copy; २०२६ विमल फार्मेसी।</p>
  </footer>

  <script>
    let medicineDatabase = [];
    let searchTimeout = null;

    async function init() {
        const status = document.getElementById('status-msg');
        try {
            // Ensure medicines.json is in the same folder as this HTML
            const response = await fetch('./medicines.json');
            if (!response.ok) throw new Error('File not found');
            medicineDatabase = await response.json();
            status.innerText = "औषधी खोज्न सुरु गर्नुहोस्।";
        } catch (e) {
            status.innerHTML = "<span style='color:red;'>त्रुटि: medicines.json फाइल भेटिएन।</span>";
            console.error(e);
        }
    }

    function debounceSearch() {
        clearTimeout(searchTimeout);
        searchTimeout = setTimeout(executeSearch, 300);
    }

    function executeSearch() {
        const query = document.getElementById('medInput').value.toLowerCase().trim();
        const grid = document.getElementById('resultsGrid');
        const status = document.getElementById('status-msg');

        if (query.length < 2) {
            grid.innerHTML = "";
            status.innerText = "खोज्नका लागि कम्तिमा २ अक्षर टाइप गर्नुहोस्।";
            return;
        }

        const filtered = medicineDatabase.filter(m => 
            (m["Product Name"] && m["Product Name"].toLowerCase().includes(query)) || 
            (m["category"] && m["category"].toLowerCase().includes(query)) ||
            (m["Medicine use for"] && m["Medicine use for"].toLowerCase().includes(query))
        ).slice(0, 40);

        if (filtered.length === 0) {
            grid.innerHTML = "";
            status.innerText = "माफ गर्नुहोस्, तपाईंले खोज्नुभएको औषधी भेटिएन।";
            return;
        }

        status.innerText = `${filtered.length} नतिजाहरू देखाइएको छ।`;

        grid.innerHTML = filtered.map(m => {
            // Encode the message for WhatsApp to handle special characters safely
            const waMessage = encodeURIComponent(`नमस्ते, मलाई ${m["Product Name"]} को बारेमा जानकारी चाहिएको थियो।`);
            
            return `
            <div class="med-card">
                <div>
                    <div class="tag-row">
                        <span class="category-badge">${m["category"] || 'General'}</span>
                        <small>${m["Small Unit"] || ''} Unit</small>
                    </div>
                    <h3>${m["Product Name"]}</h3>
                    <p style="font-size:0.9rem;"><strong>प्रयोग:</strong> ${m["Medicine use for"] || 'जानकारी उपलब्ध छैन'}</p>
                </div>
                <div>
                    <div class="price-tag">रू ${m["Sales price"] || '--'}</div>
                    <div class="btn-group">
                        <a href="tel:056593288" class="card-btn call-btn"><i class="fas fa-phone"></i> सोधपुछ</a>
                        <a href="https://wa.me/9779855065327?text=${waMessage}" target="_blank" class="card-btn wa-btn">
                            <i class="fab fa-whatsapp"></i> अर्डर
                        </a>
                    </div>
                </div>
            </div>
        `}).join('');
    }

    init();
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="ne">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>IME Life AI Agent | Bimal Pharmacy</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <style>
    /* --- DESIGN SETTINGS --- */
    :root {
      --primary: #2e7d32;
      --ime-red: #ed1c24;
      --light-bg: #f8fafc;
      --white: #ffffff;
      --gemini-gradient: linear-gradient(135deg, #ed1c24, #fbc02d);
    }
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
    body { background-color: var(--light-bg); padding-bottom: 80px; color: #333; }

    /* Header */
    .app-header {
      background: var(--white); padding: 10px 3%; position: sticky; top: 0; z-index: 1000;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05); display: flex; justify-content: space-between; align-items: center;
    }
    .brand { font-size: 1.4rem; font-weight: 800; color: var(--primary); display: flex; align-items: center; gap: 10px; }
    .brand img { height: 45px; width: 45px; border-radius: 50%; border: 2px solid var(--primary); }
    
    /* Navigation */
    .desktop-nav { display: none; }
    .desktop-nav ul { display: flex; list-style: none; gap: 10px; margin: 0; padding: 0; align-items: center; }
    .desktop-nav a { text-decoration: none; color: #555; font-weight: 600; padding: 8px 12px; font-size: 0.9rem; border-radius: 5px; transition: 0.3s; white-space: nowrap; }
    .desktop-nav a:hover { background-color: #e8f5e9; color: var(--primary); }
    .desktop-nav a.active { background-color: var(--ime-red); color: white; }

    /* Search Section */
    .search-section { text-align: center; padding: 50px 20px; background: white; border-bottom: 1px solid #ddd; }
    .ime-logo-text { color: var(--ime-red); font-weight: 800; font-size: 2.2rem; text-transform: uppercase; letter-spacing: 1px; }
    .search-wrapper { max-width: 650px; margin: 25px auto 0; position: relative; display: flex; gap: 10px; }
    .search-input { width: 100%; padding: 18px 25px; border-radius: 50px; border: 2px solid #ddd; font-size: 1.1rem; outline: none; transition: 0.3s; }
    .btn-search { background: var(--gemini-gradient); color: white; border: none; width: 60px; height: 60px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 1.3rem; }

    /* Result Box */
    .ai-container { max-width: 800px; margin: 30px auto; padding: 0 20px; }
    .ai-card { background: white; border-radius: 20px; padding: 30px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); border-top: 5px solid var(--ime-red); display: none; }
    .loader { display: none; text-align: center; margin-top: 20px; }
    .spinner { width: 45px; height: 45px; border: 4px solid #f3f3f3; border-top: 4px solid var(--ime-red); border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto; }
    
    /* Mobile Nav */
    .mobile-nav { position: fixed; bottom: 0; left: 0; width: 100%; background: white; display: grid; grid-template-columns: repeat(5, 1fr); padding: 10px 0; border-top: 1px solid #eee; z-index: 1001; }
    .nav-item { text-align: center; text-decoration: none; color: #999; font-size: 0.7rem; }
    .nav-item i { display: block; font-size: 1.3rem; margin-bottom: 4px; }
    .nav-item.active { color: var(--ime-red); }
    
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    @media (min-width: 900px) { .mobile-nav { display: none; } .desktop-nav { display: block; } }
  </style>
</head>
<body>

  <header class="app-header">
    <div class="brand">
      <img src="https://raw.githubusercontent.com/juction4love/bimalpharmacy/main/logo.svg" alt="Logo">
      <span>Bimal Pharmacy</span>
    </div>
    <nav class="desktop-nav">
      <ul>
        <li><a href="index.html">गृहपृष्ठ</a></li>
        <li><a href="medical-guide.html">औषधी गाइड</a></li>
        <li><a href="knowledge.html">स्वास्थ्य ज्ञान</a></li>
        <li><a href="order.html">अर्डर</a></li>
        <li><a href="service.html">सेवाहरू</a></li>
        <li><a href="notice.html">सूचना</a></li>
        <li><a href="search.html" class="active"><i class="fas fa-search"></i> खोज्नुहोस्</a></li> 
        <li><a href="contact.html">सम्पर्क</a></li>
        <li><a href="emergency.html">आपतकालीन</a></li>
      </ul>
    </nav>
  </header>

  <section class="search-section">
    <h2 class="ime-logo-text">IME Life Insurance</h2>
    <p style="color: #666; margin-top: 5px; font-size: 1.1rem;">तपाईंको सुरक्षा, हाम्रो जिम्मेवारी। AI लाई सोध्नुहोस्।</p>
    <div class="search-wrapper">
      <input type="text" id="aiInput" class="search-input" placeholder="प्रश्न सोध्नुहोस् (e.g. 10 लाखको पोलिसी...)" onkeypress="handleEnter(event)">
      <button onclick="fetchGeminiAnswer()" class="btn-search"><i class="fas fa-paper-plane"></i></button>
    </div>
  </section>

  <div class="ai-container">
    <div id="loadingBox" class="loader">
      <div class="spinner"></div>
      <p style="margin-top: 10px; color: #666;">AI ले सोच्दैछ...</p>
    </div>
    <div id="aiResultBox" class="ai-card">
      <div style="display:flex; align-items:center; gap:10px; margin-bottom:15px; border-bottom:1px solid #eee; padding-bottom:10px;">
        <i class="fas fa-shield-alt" style="font-size:1.5rem; color:var(--ime-red);"></i>
        <h3 style="color:#333;">IME Life जानकारी</h3>
      </div>
      <div id="aiText" style="font-size: 1.05rem; line-height: 1.7; color: #444;"></div>
      <div style="margin-top: 20px; font-size: 0.85rem; color: #888; text-align: center; background:#fff5f5; padding:10px; border-radius:10px;">
        *यो जानकारी AI ले दिएको हो। आधिकारिक जानकारीको लागि <strong>बिमल लामिछाने (अभिकर्ता)</strong> सँग सम्पर्क गर्नुहोस्।
      </div>
    </div>
  </div>

  <nav class="mobile-nav">
    <a href="index.html" class="nav-item"><i class="fas fa-home"></i> होम</a>
    <a href="search.html" class="nav-item active"><i class="fas fa-robot"></i> AI Agent</a>
    <a href="order.html" class="nav-item"><i class="fas fa-file-prescription"></i> अर्डर</a>
    <a href="emergency.html" class="nav-item"><i class="fas fa-ambulance"></i> आपतकालीन</a>
    <a href="contact.html" class="nav-item"><i class="fas fa-user"></i> सम्पर्क</a>
  </nav>

  <script>
    const API_KEY = "AIzaSyBly_wvcUIeFdcfpvNKgo1co98EHcQTwdE"; 
    
    // List of models to try (Priority Order)
    const MODEL_LIST = [
        "gemini-1.5-flash",
        "gemini-1.5-flash-001",
        "gemini-1.5-pro",
        "gemini-1.0-pro"
    ];

    function handleEnter(e) { if (e.key === 'Enter') fetchGeminiAnswer(); }

    async function fetchGeminiAnswer() {
      const input = document.getElementById('aiInput').value.trim();
      const loader = document.getElementById('loadingBox');
      const resultBox = document.getElementById('aiResultBox');
      const textBox = document.getElementById('aiText');

      if (!input) return;

      resultBox.style.display = "none";
      loader.style.display = "block";
      
      const prompt = `
        Act as an expert insurance agent for "IME Life Insurance Nepal".
        Explain the query "${input}" in simple Nepali language.
        If asked about a policy, structure the answer with:
        1. **योजनाको नाम (Plan Name):**
        2. **मुख्य फाइदा (Benefits):**
        3. **आवश्यकता (Requirements):**
        4. **किन यो राम्रो छ?**
        If the query is general, explain the importance of insurance politely.
        Always end with: "सम्पर्क: बिमल लामिछाने (IME Life अभिकर्ता)"
      `;

      let success = false;

      // --- SMART LOOP: Try models one by one ---
      for (const modelName of MODEL_LIST) {
          try {
              console.log("Trying model:", modelName); // Debugging
              const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${modelName}:generateContent?key=${API_KEY}`, {
                  method: 'POST',
                  headers: { 'Content-Type': 'application/json' },
                  body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
              });

              const data = await response.json();

              // If Error, Continue to next model
              if (data.error) {
                  console.warn(`Model ${modelName} failed:`, data.error.message);
                  continue; 
              }

              // If Success, Show Result and Break Loop
              if (data.candidates && data.candidates[0].content) {
                  const rawText = data.candidates[0].content.parts[0].text;
                  const formattedText = rawText
                      .replace(/\*\*(.*?)\*\*/g, '<strong style="color:#ed1c24;">$1</strong>')
                      .replace(/\*/g, '•') 
                      .replace(/\n/g, '<br>');

                  textBox.innerHTML = formattedText;
                  resultBox.style.display = "block";
                  success = true;
                  break; // Stop loop, we found a working model!
              }
          } catch (e) {
              console.error("Network error with", modelName);
          }
      }
      // ----------------------------------------

      loader.style.display = "none";

      if (!success) {
          alert("माफ गर्नुहोस्, अहिले सिस्टम व्यस्त छ। कृपया केही समयपछि प्रयास गर्नुहोस्।");
      }
    }
  </script>
</body>
</html>

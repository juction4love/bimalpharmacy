<div id="orderApp" class="card" style="border-top: 8px solid #2e7d32; background: #ffffff; padding: 30px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); max-width: 650px; margin: 30px auto; font-family: 'Segoe UI', system-ui, sans-serif; transition: 0.3s;">
    
    <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 25px;">
        <div style="text-align: left;">
            <h2 style="color: #1b5e20; margin: 0; font-size: 1.8rem;"><i class="fas fa-file-invoice-dollar"></i> Smart Order Slip</h2>
            <p style="font-size: 0.85rem; color: #666;">рдмрд┐рдорд▓ рдлрд╛рд░реНрдореЗрд╕реА - рдЧреБрдгрд╕реНрддрд░реАрдп рдЦрд░рд┐рдж рд╡реНрдпрд╡рд╕реНрдерд╛рдкрди</p>
        </div>
        <button onclick="toggleDarkMode()" style="background: #eee; border: none; padding: 10px; border-radius: 50%; cursor: pointer;"><i class="fas fa-moon"></i></button>
    </div>
    
    <div style="display: flex; justify-content: space-between; background: #f1f8f1; padding: 12px; border-radius: 12px; margin-bottom: 20px; font-size: 0.85rem; border: 1px solid #ddd;">
      <span><i class="far fa-calendar-check"></i> рдорд┐рддрд┐: <span id="currentDate" style="font-weight: bold;"></span></span>
      <span style="color: #d32f2f; font-weight: bold;">ID: <span id="orderID"></span></span>
    </div>

    <div style="margin-bottom: 15px;">
        <label style="font-weight: 700; display: block; margin-bottom: 5px;">рд╡рд┐рдХреНрд░реЗрддрд╛ / рд╕рдкреНрд▓рд╛рдпрд░рдХреЛ рдирд╛рдо:</label>
        <input type="text" id="vendorName" placeholder="рд╕рдкреНрд▓рд╛рдпрд░ рд╡рд╛ рдХрдореНрдкрдиреАрдХреЛ рдирд╛рдо" style="width: 100%; padding: 12px; border-radius: 12px; border: 1px solid #ccc; outline: none; background: #fafafa;">
    </div>

    <div style="margin-bottom: 20px; position: relative;">
        <label style="font-weight: 700; display: block; margin-bottom: 5px;">рд╕рд╛рдорд╛рдирдХреЛ рд╡рд┐рд╡рд░рдг (Items List):</label>
        <textarea id="itemList" rows="8" placeholder="1. Item Name - Qty" style="width: 100%; padding: 15px; border-radius: 12px; border: 1px solid #ccc; outline: none; background: #fafafa; resize: vertical;"></textarea>
        <button onclick="startDictation()" title="рдмреЛрд▓реЗрд░ рд▓реЗрдЦреНрдиреБрд╣реЛрд╕реН" style="position: absolute; right: 10px; bottom: 10px; background: var(--danger); color: white; border: none; width: 40px; height: 40px; border-radius: 50%; cursor: pointer; box-shadow: 0 4px 10px rgba(0,0,0,0.2);">
            <i class="fas fa-microphone"></i>
        </button>
    </div>

    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 15px;">
        <button onclick="sendToMe()" style="background: #075E54; color: white; padding: 16px; border: none; border-radius: 12px; font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px;">
            <i class="fab fa-whatsapp"></i> My WhatsApp
        </button>
        <button onclick="chooseSupplier()" style="background: #2e7d32; color: white; padding: 16px; border: none; border-radius: 12px; font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px;">
            <i class="fas fa-share-alt"></i> Any Supplier
        </button>
    </div>

    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 15px;">
        <button onclick="generatePDF()" style="background: #0288d1; color: white; padding: 12px; border: none; border-radius: 12px; font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; font-size: 0.9rem;">
            <i class="fas fa-file-pdf"></i> Save as PDF
        </button>
        <button onclick="nativeShare()" style="background: #607d8b; color: white; padding: 12px; border: none; border-radius: 12px; font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; font-size: 0.9rem;">
            <i class="fas fa-external-link-alt"></i> Multi Share
        </button>
    </div>

    <button onclick="clearForm()" style="background: #f5f5f5; color: #d32f2f; width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 12px; font-weight: bold; cursor: pointer;">
        <i class="fas fa-eraser"></i> Clear Form
    </button>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>
    // рез. рд╕реБрд░реБрд╡рд╛рддреА рд╕реЗрдЯрд┐рдЩ
    function setupOrder() {
        const options = { year: 'numeric', month: 'long', day: 'numeric' };
        document.getElementById('currentDate').innerText = new Date().toLocaleDateString('ne-NP', options);
        document.getElementById('orderID').innerText = 'BIMAL-' + Math.floor(1000 + Math.random() * 9000);
    }
    setupOrder();

    // реи. рдореЗрд╕реЗрдЬ рддрдпрд╛рд░ рдкрд╛рд░реНрдиреЗ (Professional Tone)
    function createMessage() {
        const vName = document.getElementById('vendorName').value.trim() || "рд╕рдкреНрд▓рд╛рдпрд░";
        const items = document.getElementById('itemList').value.trim();
        if (!items) { alert("рдХреГрдкрдпрд╛ рд╕рд╛рдорд╛рдирдХреЛ рд╡рд┐рд╡рд░рдг рднрд░реНрдиреБрд╣реЛрд╕реНред"); return null; }

        return "рдирдорд╕реНрддреЗ " + vName + " рдЬреА, ЁЯЩП%0A" +
               "рдо рдмрд┐рдорд▓ рдлрд╛рд░реНрдореЗрд╕реА (рднрд░рддрдкреБрд░) рдмрд╛рдЯ рдмрд┐рдорд▓ рд▓рд╛рдорд┐рдЫрд╛рдиреЗред рд╣рд╛рдореНрд░реЛ рдлрд╛рд░реНрдореЗрд╕реАрдХреЛ рд▓рд╛рдЧрд┐ рдЖрд╡рд╢реНрдпрдХ рдХреЗрд╣реА рд╕рд╛рдорд╛рдирд╣рд░реВрдХреЛ *рдирдпрд╛рдБ рдЦрд░рд┐рдж рдЕрд░реНрдбрд░ (Purchase Order)* рдкрдард╛рдПрдХреЛ рдЫреБред рдХреГрдкрдпрд╛ рдпреА рд╕рд╛рдорд╛рдирд╣рд░реВ рдЙрдкрд▓рдмреНрдз рдЧрд░рд╛рдИ рд╕рд╣рдпреЛрдЧ рдЧрд░рд┐рджрд┐рдиреБрд╣реБрди рд╣рд╛рд░реНрджрд┐рдХ рдЕрдиреБрд░реЛрдз рдЧрд░реНрджрдЫреБ:%0A%0A" +
               "тФБтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБ%0A" +
               "ЁЯУМ *ORDER LIST:*%0A" + 
               encodeURIComponent(items) + "%0A" +
               "тФБтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБ%0A%0A" +
               "ЁЯУЕ рдорд┐рддрд┐: " + document.getElementById('currentDate').innerText + "%0A" +
               "ЁЯФв ID: #" + document.getElementById('orderID').innerText + "%0A%0A" +
               "рдзрдиреНрдпрд╡рд╛рджред - рдмрд┐рдорд▓ рд▓рд╛рдорд┐рдЫрд╛рдиреЗ";
    }

    // рей. Voice Typing (Speech to Text)
    function startDictation() {
        if (window.hasOwnProperty('webkitSpeechRecognition')) {
            var recognition = new webkitSpeechRecognition();
            recognition.continuous = false;
            recognition.interimResults = false;
            recognition.lang = "ne-NP";
            recognition.start();
            recognition.onresult = function(e) {
                document.getElementById('itemList').value += e.results[0][0].transcript + "\n";
                recognition.stop();
            };
        } else { alert("рддрдкрд╛рдИрдБрдХреЛ рдмреНрд░рд╛рдЙрдЬрд░рдорд╛ рднреНрд╡рд╛рдЗрд╕ рдЯрд╛рдЗрдкрд┐рдЩ рд╕рдкреЛрд░реНрдЯ рдЧрд░реНрджреИрдиред"); }
    }

    // рек. PDF Generation
    function generatePDF() {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        doc.text("Purchase Order - Bimal Pharmacy", 20, 20);
        doc.text("ID: " + document.getElementById('orderID').innerText, 20, 30);
        doc.text("Vendor: " + (document.getElementById('vendorName').value || "N/A"), 20, 40);
        doc.text("Items:", 20, 50);
        doc.text(document.getElementById('itemList').value, 20, 60);
        doc.save("Bimal_Order.pdf");
    }

    // рел. Multi Share (Viber, Messenger, etc.)
    async function nativeShare() {
        const msg = createMessage();
        if(msg) {
            try {
                await navigator.share({ title: 'Bimal Pharmacy Order', text: decodeURIComponent(msg) });
            } catch (err) { alert("рдпреЛ рдмреНрд░рд╛рдЙрдЬрд░рдорд╛ рд╢реЗрдпрд░ рдлрд┐рдЪрд░ рдЙрдкрд▓рдмреНрдз рдЫреИрдиред"); }
        }
    }

    // рем. Dark Mode
    function toggleDarkMode() {
        const app = document.getElementById('orderApp');
        if (app.style.background === 'rgb(34, 34, 34)') {
            app.style.background = '#ffffff'; app.style.color = '#2c3e50';
        } else {
            app.style.background = '#222222'; app.style.color = '#ffffff';
        }
    }

    function sendToMe() { const msg = createMessage(); if(msg) window.open("https://wa.me/9779855065327?text=" + msg, '_blank'); }
    function chooseSupplier() { const msg = createMessage(); if(msg) window.open("https://wa.me/?text=" + msg, '_blank'); }
    function clearForm() { if(confirm("Clear everything?")) { document.getElementById('vendorName').value = ""; document.getElementById('itemList').value = ""; setupOrder(); } }
</script>

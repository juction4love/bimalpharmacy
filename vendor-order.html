<div style="background: white; padding: 20px 5%; display: flex; align-items: center; gap: 20px; border-bottom: 5px solid #2e7d32; border-radius: 20px 20px 0 0; max-width: 650px; margin: 30px auto -30px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); position: relative; z-index: 2;">
    <div style="height: 70px; width: 70px; border-radius: 50%; border: 3px solid #2e7d32; overflow: hidden; background: white;">
        <img src="https://raw.githubusercontent.com/juction4love/bimalpharmacy/main/logo.svg" alt="Logo" style="width: 100%; height: 100%; object-fit: cover;">
    </div>
    <div style="flex: 1;">
        <h1 style="color: #2e7d32; font-size: 1.8rem; margin: 0; line-height: 1.1;">рдмрд┐рдорд▓ рдлрд╛рд░реНрдореЗрд╕реА</h1>
        <p style="font-size: 0.85rem; color: #555; margin: 5px 0 0;">рднрд░рддрдкреБрд░-рен, рдЪрд┐рддрд╡рди (рдХреНрдпрд╛рдиреНрд╕рд░ рдЕрд╕реНрдкрддрд╛рд▓ рд░реЛрдб)</p>
    </div>
</div>

<div id="orderApp" class="card" style="border-top: 8px solid #2e7d32; background: #ffffff; padding: 45px 30px 30px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); max-width: 650px; margin: 0 auto 30px; font-family: 'Segoe UI', system-ui, sans-serif; transition: 0.3s; position: relative;">
    
    <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 25px;">
        <div style="text-align: left;">
            <h2 style="color: #1b5e20; margin: 0; font-size: 1.5rem;"><i class="fas fa-file-invoice-dollar"></i> Smart Order Slip</h2>
            <p style="font-size: 0.8rem; color: #666;">рдЖрдзрд┐рдХрд╛рд░рд┐рдХ рдбрд┐рдЬрд┐рдЯрд▓ рдЦрд░рд┐рдж рдЕрд░реНрдбрд░</p>
        </div>
        <button onclick="toggleDarkMode()" id="themeBtn" style="background: #f0f0f0; border: none; padding: 10px; border-radius: 50%; cursor: pointer;"><i class="fas fa-moon"></i></button>
    </div>
    
    <div style="display: flex; justify-content: space-between; background: #f1f8f1; padding: 12px; border-radius: 12px; margin-bottom: 20px; font-size: 0.85rem; border: 1px solid #ddd;">
      <span><i class="far fa-calendar-check"></i> рдорд┐рддрд┐: <span id="currentDate" style="font-weight: bold;"></span></span>
      <span style="color: #d32f2f; font-weight: bold;">ID: <span id="orderID"></span></span>
    </div>

    <div style="margin-bottom: 15px;">
        <label style="font-weight: 700; display: block; margin-bottom: 5px;">рд╡рд┐рдХреНрд░реЗрддрд╛ / рд╕рдкреНрд▓рд╛рдпрд░рдХреЛ рдирд╛рдо:</label>
        <div style="position: relative;">
            <i class="fas fa-truck-moving" style="position: absolute; left: 15px; top: 15px; color: #888;"></i>
            <input type="text" id="vendorName" placeholder="рд╕рдкреНрд▓рд╛рдпрд░ рд╡рд╛ рдХрдореНрдкрдиреАрдХреЛ рдирд╛рдо" style="width: 100%; padding: 12px 12px 12px 45px; border-radius: 12px; border: 1px solid #ccc; outline: none; background: #fafafa; font-size: 1rem;">
        </div>
    </div>

    <div style="margin-bottom: 20px; position: relative;">
        <label style="font-weight: 700; display: block; margin-bottom: 5px;">рд╕рд╛рдорд╛рдирдХреЛ рд╡рд┐рд╡рд░рдг (Items List):</label>
        <textarea id="itemList" rows="8" placeholder="рдЙрджрд╛: &#10;1. Paracetamol 500mg - 10 Boxes" style="width: 100%; padding: 15px; border-radius: 12px; border: 1px solid #ccc; outline: none; background: #fafafa; resize: vertical; font-size: 1rem; font-family: inherit;"></textarea>
        <button onclick="startDictation()" title="рдмреЛрд▓реЗрд░ рд▓реЗрдЦреНрдиреБрд╣реЛрд╕реН" style="position: absolute; right: 12px; bottom: 12px; background: #d32f2f; color: white; border: none; width: 42px; height: 42px; border-radius: 50%; cursor: pointer; box-shadow: 0 4px 10px rgba(0,0,0,0.2);">
            <i class="fas fa-microphone"></i>
        </button>
    </div>

    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 12px;">
        <button onclick="sendToMe()" style="background: #075E54; color: white; padding: 16px; border: none; border-radius: 12px; font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px;">
            <i class="fab fa-whatsapp"></i> My WhatsApp
        </button>
        <button onclick="chooseSupplier()" style="background: #2e7d32; color: white; padding: 16px; border: none; border-radius: 12px; font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px;">
            <i class="fas fa-share-alt"></i> Any Supplier
        </button>
    </div>

    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-bottom: 15px;">
        <button onclick="printOrder()" style="background: #455a64; color: white; padding: 12px; border: none; border-radius: 12px; font-weight: bold; cursor: pointer;">
            <i class="fas fa-print"></i> Print
        </button>
        <button onclick="generatePDF()" style="background: #0288d1; color: white; padding: 12px; border: none; border-radius: 12px; font-weight: bold; cursor: pointer;">
            <i class="fas fa-file-pdf"></i> PDF
        </button>
        <button onclick="nativeShare()" style="background: #607d8b; color: white; padding: 12px; border: none; border-radius: 12px; font-weight: bold; cursor: pointer;">
            <i class="fas fa-share"></i> Share
        </button>
    </div>

    <button onclick="clearForm()" style="background: #f5f5f5; color: #d32f2f; width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 12px; font-weight: bold; cursor: pointer;">
        <i class="fas fa-eraser"></i> Clear Form (рдЦрд╛рд▓реА рдЧрд░реНрдиреБрд╣реЛрд╕реН)
    </button>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>
    // рез. Auto ID рд░ рдорд┐рддрд┐
    function generateAutoID() {
        const now = new Date();
        const options = { year: 'numeric', month: 'long', day: 'numeric' };
        document.getElementById('currentDate').innerText = now.toLocaleDateString('ne-NP', options);
        
        const dateStr = now.getFullYear() + String(now.getMonth() + 1).padStart(2, '0') + String(now.getDate()).padStart(2, '0');
        const randomNum = Math.floor(1000 + Math.random() * 9000);
        document.getElementById('orderID').innerText = `BIMAL-${dateStr}-${randomNum}`;
    }
    generateAutoID();

    // реи. рд╕рдиреНрджреЗрд╢ рдирд┐рд░реНрдорд╛рдг
    function createMessage() {
        const vName = document.getElementById('vendorName').value.trim() || "рдЬреА";
        const items = document.getElementById('itemList').value.trim();
        const id = document.getElementById('orderID').innerText;
        const date = document.getElementById('currentDate').innerText;

        if (!items) { alert("рдХреГрдкрдпрд╛ рд╕рд╛рдорд╛рдирдХреЛ рд╡рд┐рд╡рд░рдг рднрд░реНрдиреБрд╣реЛрд╕реНред"); return null; }

        return "рдирдорд╕реНрддреЗ " + vName + ", ЁЯЩП%0A" +
               "рдо рдмрд┐рдорд▓ рдлрд╛рд░реНрдореЗрд╕реА (рднрд░рддрдкреБрд░) рдмрд╛рдЯ рдмрд┐рдорд▓ рд▓рд╛рдорд┐рдЫрд╛рдиреЗред рд╣рд╛рдореНрд░реЛ рдлрд╛рд░реНрдореЗрд╕реАрдХреЛ рд▓рд╛рдЧрд┐ рдЖрд╡рд╢реНрдпрдХ рдХреЗрд╣реА рд╕рд╛рдорд╛рдирд╣рд░реВрдХреЛ *рдирдпрд╛рдБ рдЦрд░рд┐рдж рдЕрд░реНрдбрд░ (Purchase Order)* рдпрд╕реИ рд╕рдиреНрджреЗрд╢рдорд╛рд░реНрдлрдд рдкрдард╛рдПрдХреЛ рдЫреБред рдХреГрдкрдпрд╛ рдЙрд▓реНрд▓реЗрдЦрд┐рдд рд╕рд╛рдорд╛рдирд╣рд░реВ рдЙрдкрд▓рдмреНрдз рдЧрд░рд╛рдИ рд╕рд╣рдпреЛрдЧ рдЧрд░рд┐рджрд┐рдиреБрд╣реБрди рд╣рд╛рд░реНрджрд┐рдХ рдЕрдиреБрд░реЛрдз рдЧрд░реНрджрдЫреБ:%0A%0A" +
               "тФБтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБ%0A" +
               "ЁЯУМ *ORDER LIST:*%0A" + 
               "тФБтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБ%0A" +
               encodeURIComponent(items) + "%0A" +
               "тФБтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБтФБ%0A%0A" +
               "ЁЯУЕ рдорд┐рддрд┐: " + date + "%0A" +
               "ЁЯФв рдЕрд░реНрдбрд░ ID: #" + id + "%0A%0A" +
               "рд╕рд╛рдорд╛рди рдХрдиреНрдлрд░реНрдо рднрдПрдкрдЫрд┐ рдорд▓рд╛рдИ рдЬрд╛рдирдХрд╛рд░реА рджрд┐рдиреБрд╣реЛрд▓рд╛ред%0A" +
               "рдзрдиреНрдпрд╡рд╛рджред - рдмрд┐рдорд▓ рд▓рд╛рдорд┐рдЫрд╛рдиреЗ%0A" +
               "ЁЯУЮ репреорелрелрежремрелрейреирен";
    }

    // рей. Voice Typing
    function startDictation() {
        if (window.hasOwnProperty('webkitSpeechRecognition')) {
            var recognition = new webkitSpeechRecognition();
            recognition.lang = "ne-NP";
            recognition.start();
            recognition.onresult = function(e) {
                document.getElementById('itemList').value += e.results[0][0].transcript + "\n";
                recognition.stop();
            };
        } else { alert("Browser Not Supported"); }
    }

    // рек. Print
    function printOrder() {
        const vendor = document.getElementById('vendorName').value || "N/A";
        const items = document.getElementById('itemList').value;
        const id = document.getElementById('orderID').innerText;
        const date = document.getElementById('currentDate').innerText;

        const win = window.open('', '', 'height=700,width=900');
        win.document.write('<html><head><title>Print Order</title><style>body{padding:40px;font-family:sans-serif;} .hd{text-align:center;border-bottom:2px solid #2e7d32;} .items{background:#f9f9f9;padding:20px;white-space:pre-wrap;border:1px solid #ddd;}</style></head><body>');
        win.document.write('<div class="hd"><h1>рдмрд┐рдорд▓ рдлрд╛рд░реНрдореЗрд╕реА</h1><p>рднрд░рддрдкреБрд░-рен, рдЪрд┐рддрд╡рди | репреорелрелрежремрелрейреирен</p><h2>PURCHASE ORDER</h2></div>');
        win.document.write('<p><strong>рд╡рд┐рдХреНрд░реЗрддрд╛:</strong> '+vendor+' <br> <strong>рдорд┐рддрд┐:</strong> '+date+' <br> <strong>ID:</strong> #'+id+'</p>');
        win.document.write('<h4>рд╕рд╛рдорд╛рдирдХреЛ рд╕реВрдЪреА:</h4><div class="items">'+items+'</div>');
        win.document.write('</body></html>');
        win.document.close();
        win.print();
    }

    // рел. PDF
    function generatePDF() {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        doc.text("BIMAL PHARMACY - PURCHASE ORDER", 10, 10);
        doc.text("Order ID: " + document.getElementById('orderID').innerText, 10, 20);
        doc.text("Vendor: " + document.getElementById('vendorName').value, 10, 30);
        doc.text("Items:\n" + document.getElementById('itemList').value, 10, 45);
        doc.save(`Bimal_Order_${document.getElementById('orderID').innerText}.pdf`);
    }

    // рем. Utils
    function toggleDarkMode() {
        const app = document.getElementById('orderApp');
        const isDark = app.style.background === 'rgb(34, 34, 34)';
        app.style.background = isDark ? '#ffffff' : '#222222';
        app.style.color = isDark ? '#333' : '#fff';
    }

    function sendToMe() { const msg = createMessage(); if(msg) window.open("https://wa.me/9779855065327?text=" + msg, '_blank'); }
    function chooseSupplier() { const msg = createMessage(); if(msg) window.open("https://wa.me/?text=" + msg, '_blank'); }
    async function nativeShare() { const msg = createMessage(); if(msg) navigator.share({text: decodeURIComponent(msg)}); }
    
    function clearForm() { if(confirm("Clear?")) { document.getElementById('vendorName').value=""; document.getElementById('itemList').value=""; generateAutoID(); } }
</script>
